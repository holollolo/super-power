<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>초능력 연구 도시 위키</title>
    <style>
        /* 기본 스타일 */
        html { scroll-behavior: smooth; }
        :root { --namu-green: #00A495; --link-color: #0275d8; --bg-gray: #f0f0f0; --border-color: #ccc; }
        body { font-family: 'Malgun Gothic', 'Noto Sans KR', sans-serif; margin: 0; padding: 0; background-color: var(--bg-gray); color: #373a3c; line-height: 1.6; }
        a { text-decoration: none; color: var(--link-color); cursor: pointer; }
        a:hover { text-decoration: underline; }
        .navbar { background-color: #2e4e3f; height: 50px; width: 100%; margin-bottom: 20px;}
        .container { display: flex; max-width: 1100px; margin: 0 auto; background: white; min-height: 100vh; border-left: 1px solid #ddd; border-right: 1px solid #ddd; align-items: stretch; }
        .main-content { flex: 1; padding: 30px; max-width: 800px; }
        .sidebar { width: 220px; background-color: #f9f9f9; border-left: 1px solid #ddd; padding: 20px; flex-shrink: 0; }
        
        .sidebar-title { font-weight: bold; color: #2e4e3f; border-bottom: 2px solid var(--namu-green); padding-bottom: 5px; margin-bottom: 10px; font-size: 1.1rem; cursor: pointer; }
        .sidebar-title:hover { opacity: 0.8; }

        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar li { margin-bottom: 8px; font-size: 0.95rem; }
        .sidebar li a { display: block; padding: 5px; border-radius: 4px; transition: background 0.2s; }
        .sidebar li a:hover { background-color: #e9ecef; text-decoration: none; }
        #sidebar-doc-list { max-height: 70vh; overflow-y: auto; padding-right: 10px; margin-top: 5px; padding-top: 5px; }
        
        /* 위키 본문 스타일 */
        .title-area { border-bottom: 2px solid gray; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-end; }
        .title-area h1 { margin: 0; font-size: 2.2rem; font-weight: normal; }
        .action-buttons button { background: white; border: 1px solid #ccc; padding: 5px 10px; cursor: pointer; font-size: 0.8rem; }
        .toc { display: inline-block; background-color: #f9f9f9; border: 1px solid #ccc; padding: 10px 20px; margin: 10px 0; min-width: 200px; }
        .toc-title { text-align: center; font-weight: bold; margin-bottom: 5px; }
        .toc ul { list-style: none; padding-left: 10px; margin: 0; }
        h2 { border-bottom: 1px solid var(--border-color); padding-bottom: 5px; margin-top: 30px; font-size: 1.5rem; color: #333; scroll-margin-top: 20px; }
        .wiki-table { border-collapse: collapse; width: 100%; margin: 10px 0; border: 1px solid #ccc; }
        .wiki-table td, .wiki-table th { border: 1px solid #ccc; padding: 8px; }
        .wiki-table th { background-color: var(--namu-green); color: white; text-align: center; }
        .category { border: 1px solid #ccc; padding: 5px; border-radius: 5px; margin-bottom: 10px; font-size: 0.8rem; background: #fcfcfc; }
        .quote { margin: 10px 20px; padding: 10px; background: #f9f9f9; border-left: 4px solid var(--namu-green); }
        
        /* 프로필 박스 및 이미지 설정 */
        .profile-box { float: right; width: 300px; margin: 0 0 20px 20px; border: 1px solid var(--border-color); background: #fff; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); font-size: 0.9rem; }
        .profile-header { background-color: var(--namu-green); color: white; font-weight: bold; text-align: center; padding: 8px 0; font-size: 1.1rem; border-bottom: 1px solid #ddd; }
        .profile-image-area { width: 100%; text-align: center; cursor: pointer; position: relative; }
        
        /* [수정됨] 프로필 박스 내 모든 이미지의 너비를 박스에 맞춤 */
        .profile-box img { width: 100%; height: auto; display: block; }

        .profile-table { width: 100%; border-collapse: collapse; }
        .profile-table th { background-color: #f9f9f9; width: 30%; padding: 7px; border-bottom: 1px solid #eee; border-right: 1px solid #eee; text-align: center; font-weight: bold; }
        .profile-table td { padding: 7px 10px; border-bottom: 1px solid #eee; text-align: left; }
        .profile-caption { text-align: center; padding: 5px; font-weight: bold; background: #f9f9f9; }

        /* 스포일러 이미지 설정 */
        .spoiler-container { position: relative; overflow: hidden; background-color: #000; cursor: pointer; }
        .spoiler-image { filter: blur(30px); transition: filter 0.3s ease; }
        .spoiler-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem; background: rgba(0, 0, 0, 0.4); text-align: center; padding: 10px; box-sizing: border-box; z-index: 10; transition: opacity 0.3s; }
        .revealed .spoiler-image { filter: blur(0); }
        .revealed .spoiler-overlay { opacity: 0; pointer-events: none; }

        /* 목록 스타일 */
        .doc-index-list { list-style: none; padding: 0; }
        .category-header { cursor: pointer; border-bottom: 2px solid #ccc; padding-bottom: 5px; margin-top: 30px; display: flex; align-items: center; }
        .category-header::before { content: '▶'; display: inline-block; margin-right: 10px; font-size: 0.8em; transition: transform 0.2s; transform: rotate(90deg); }
        .category-header.collapsed::before { transform: rotate(0deg); }
        .category-list.hidden { display: none; }

        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; border-left: none; border-top: 1px solid #ddd; }
            .profile-box { float: none; width: 100%; margin: 0 0 20px 0; }
        }
    </style>
</head>

<body>
<div class="navbar"></div>
<div class="container">
    <div class="main-content">
        <div id="wiki-display-area">
            <p>로딩 중...</p>
        </div>
    </div>
    <div class="sidebar">
        <div class="sidebar-title" onclick="showAllPages()">전체 문서 목록</div>
        <ul id="sidebar-doc-list"></ul>
    </div>
</div>

<script type="module">
    const pageList = {
        "superpower": "초능력", "city": "초능력 연구 도시", "korea": "한국", "isolation": "초능력 격리",
        "supertool": "초능도구", "fullrecovery": "풀리커버리", "dawnoffreedom": "자유의 여명",
        "nebula": "성운교", "rakwon": "락원농장", "hanul": "한울방범대", "pleasurecity": "유흥도시",
        "yeollak": "열락(悅樂)", "medicalcenter": "On the Mend Medical Center", "kaguard": "KA Guard",
        "purehuman": "순수인간연합", "steelhyena": "강철 하이에나", "predator": "프레데터", "meari": "메아리",
        "buddhism": "정행종(正행宗)", "daejeong": "대정그룹", "hanjeongyeon": "한정연", "lukedyer": "루크 다이어",
        "janghyeonho": "장현호", "jessica": "제시카 미첼", "kimseonghun": "김성훈", "ryurakwon": "류락원",
        "parkyeon": "박연", "leeyongho": "이용호", "namgung": "남궁철호", "yurahee": "유라희", "observer": "관측자",
        "sinabro": "시나브로", "bridget": "브리짓 갤러거", "pia": "피아 슈탈", "elena": "엘레나 비아넬로",
        "swindler": "천면의 사기꾼", "isabella": "이사벨라 로시", "giant": "중압의 재앙", "purify": "정화의 재앙", "amalgamation":"융합의 재앙"
    };

    const docCategories = [
        { title: "초능력 및 설정", ids: ["superpower", "supertool"] },
        { title: "정치, 국가 및 지명", ids: ["korea", "city", "isolation", "pleasurecity"] },
        { title: "기업", ids: ["daejeong", "fullrecovery", "rakwon", "medicalcenter", "kaguard"] },
        { title: "집단 및 조직", ids: ["hanul", "nebula", "purehuman", "dawnoffreedom", "yeollak", "predator", "steelhyena", "meari", "buddhism"] },
        { title: "인물", ids: ["leeyongho", "parkyeon", "kimseonghun", "jessica", "hanjeongyeon", "janghyeonho", "lukedyer", "ryurakwon", "namgung", "bridget", "pia", "elena", "sinabro", "swindler", "isabella", "yurahee", "observer"] },
        { title: "재앙", ids: ["giant","purify","amalgamation"] }
    ];

    const sidebarList = document.getElementById('sidebar-doc-list');
    sidebarList.innerHTML = Object.entries(pageList).map(([id, title]) => `<li><a onclick="changePage('${id}')">${title}</a></li>`).join('');

    window.toggleCategory = (header) => {
        header.classList.toggle('collapsed');
        header.nextElementSibling.classList.toggle('hidden');
    };

    window.showAllPages = () => {
        const displayArea = document.getElementById('wiki-display-area');
        let html = `<div class="title-area"><h1>전체 문서 목록</h1></div><p>문서 제목을 클릭하면 목록을 볼 수 있습니다.</p>`;
        docCategories.forEach(cat => {
            html += `<h2 class="category-header collapsed" onclick="toggleCategory(this)">${cat.title}</h2>`;
            html += `<ul class="doc-index-list category-list hidden">` + cat.ids.map(id => `<li><a onclick="changePage('${id}')">${pageList[id]}</a></li>`).join('') + `</ul>`;
        });
        displayArea.innerHTML = html;
        window.scrollTo(0, 0);
    };

    window.changePage = async (pageId) => {
        const displayArea = document.getElementById('wiki-display-area');
        displayArea.innerHTML = '<p>문서를 불러오는 중입니다...</p>';
        try {
            const module = await import(`./contents/${pageId}.js`);
            const data = module.default;
            let profileHtml = '';

            const makeImageHtml = (imgUrl, title, isSpoiler) => {
                if (!imgUrl) return '';
                if (isSpoiler) {
                    return `
                        <div class="spoiler-container" onclick="if(this.classList.contains('revealed')){ window.open('${imgUrl}', '_blank'); } else { this.classList.add('revealed'); }">
                            <div class="spoiler-overlay">!! 주의 !!<br>클릭하여 확인<br>(한 번 더 클릭 시 새 탭에서 열기)</div>
                            <img src="${imgUrl}" alt="${title}" class="spoiler-image">
                        </div>`;
                }
                return `<img src="${imgUrl}" alt="${title}" style="cursor: pointer;" onclick="window.open('${imgUrl}', '_blank')">`;
            };

            if (data.profile) {
                const pName = data.profile.name || data.title;
                const imgContent = makeImageHtml(data.profile.image, pName, data.profile.isSpoiler);
                let rows = '';
                if (data.profile.birth) rows += `<tr><th>출생</th><td>${data.profile.birth}</td></tr>`;
                if (data.profile.residence) rows += `<tr><th>거주지</th><td>${data.profile.residence}</td></tr>`;
                if (data.profile.nationality) rows += `<tr><th>국적</th><td>${data.profile.nationality}</td></tr>`;
                if (data.profile.job) rows += `<tr><th>직업</th><td>${data.profile.job}</td></tr>`;
                profileHtml = `<div class="profile-box"><div class="profile-header">${pName}</div><div class="profile-image-area">${imgContent}</div><table class="profile-table">${rows}</table></div>`;
            } else if (data.image) {
                const imgContent = makeImageHtml(data.image, data.title, data.isSpoiler);
                profileHtml = `<div class="profile-box">${imgContent}<div class="profile-caption">${data.title}</div></div>`;
            }

            displayArea.innerHTML = `
                <div class="category">${data.category}</div>
                <div class="title-area"><h1>${data.title}</h1><div class="action-buttons"><button>편집</button> <button>토론</button> <button>역사</button></div></div>
                <div style="text-align: right; font-size: 0.8rem; color: gray; margin-bottom: 10px;">최근 수정 시각: ${data.lastMod}</div>
                <div>${profileHtml}${data.content}</div>`;
            window.scrollTo(0, 0);
        } catch (e) {
            console.error(e);
            displayArea.innerHTML = `<h2>오류</h2><p>문서를 불러올 수 없습니다. 서버 환경(Live Server 등)에서 실행 중인지 확인하세요.</p>`;
        }
    };

    window.onload = () => showAllPages();
</script>
</body>
</html>
